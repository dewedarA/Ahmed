<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Egypt Weather Now - Ø±Ø§Ø¯Ø§Ø± Ø·Ù‚Ø³ Ù…ØµØ±</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root { 
            --primary: #00d2ff; --dark-bg: #080a0c; --card-bg: #12161a; 
            --success: #00ff00; --danger: #ff4757; --coastal: #2ecc71;
        }

        body { 
            font-family: 'Cairo', sans-serif; margin: 0; background: var(--dark-bg); 
            color: white; overflow-x: hidden; 
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ */
        .main-header {
            background: linear-gradient(to bottom, #1a1f24, #12161a);
            text-align: center;
            padding: 30px 0;
            border-bottom: 1px solid #333;
        }
        .main-header h1 {
            margin: 0; font-size: 2.8rem; color: var(--primary);
            text-transform: uppercase; letter-spacing: 3px; font-weight: 900;
            text-shadow: 0 0 15px rgba(0, 210, 255, 0.3);
        }
        .main-header p { margin: 5px 0 0; font-size: 1rem; color: #888; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
        .stats-bar { 
            background: #1a1f24; display: flex; justify-content: space-around; padding: 12px; 
            border-bottom: 2px solid #2d3436; font-size: 0.9rem; position: sticky; top: 0; z-index: 1000; 
        }

        .container { 
            max-width: 1450px; margin: 20px auto; padding: 0 15px; 
            display: flex; flex-wrap: wrap; gap: 20px; 
        }

        #map { 
            flex: 2; height: 600px; min-width: 350px; border-radius: 30px; 
            border: 2px solid #34495e; box-shadow: 0 15px 40px rgba(0,0,0,0.8); 
        }

        .sidebar { flex: 1; min-width: 330px; display: flex; flex-direction: column; gap: 15px; }

        select { 
            width: 100%; padding: 14px; border-radius: 12px; background: #1e2329; 
            color: white; border: 2px solid #333; font-family: inherit; outline: none; 
        }

        /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø·Ù‚Ø³ */
        .weather-box { 
            position: relative; overflow: hidden; background: var(--card-bg); 
            padding: 30px; border-radius: 30px; text-align: center; 
            border: 1px solid #2d3436; min-height: 420px; 
            display: flex; flex-direction: column; justify-content: center; transition: 0.5s;
        }

        .hot-effect { background: radial-gradient(circle, rgba(255, 69, 0, 0.2) 0%, transparent 70%); border-color: #ff4500; }
        .cold-effect { background: radial-gradient(circle, rgba(0, 210, 255, 0.15) 0%, transparent 70%); border-color: var(--primary); }

        .coastal-tag { 
            position: absolute; top: 15px; right: 15px; background: var(--coastal); 
            color: black; padding: 4px 12px; border-radius: 20px; font-size: 0.7rem; font-weight: bold; 
        }

        .temp-main { 
            font-size: 6rem; font-weight: 900; background: linear-gradient(#fff, var(--primary)); 
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; 
        }

        .btn-group { display: flex; gap: 10px; }
        .gps-btn { flex: 2; padding: 15px; border-radius: 12px; background: var(--primary); border: none; font-weight: bold; cursor: pointer; font-family: inherit; }
        .csv-btn { flex: 1; background: #27ae60; color: white; border: none; border-radius: 12px; cursor: pointer; display: none; font-weight: bold; }

        .radar-pulse { border: 3px solid var(--primary); border-radius: 50%; animation: radar 1.5s infinite ease-out; position: absolute; pointer-events: none; }
        @keyframes radar { 0% { transform: scale(0.1); opacity: 1; } 100% { transform: scale(4); opacity: 0; } }
    </style>
</head>
<body>

    <header class="main-header">
        <h1>Egypt Weather Now</h1>
        <p>Ù…Ù†Ø¸ÙˆÙ…Ø© Ø§Ù„Ø±ØµØ¯ Ø§Ù„Ø¬ÙˆÙŠ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù„Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª Ø§Ù„Ù…ØµØ±ÙŠØ©</p>
    </header>

    <div class="stats-bar">
        <div>ğŸ“¡ Ø§Ù„Ø±ØµØ¯: <span style="color:var(--success)">Ù†Ø´Ø·</span></div>
        <div>ğŸ›°ï¸ Ø§Ù„Ø£Ù‚Ù…Ø§Ø±: <span style="color:var(--primary)">Ù…ØªØµÙ„Ø©</span></div>
        <div>ğŸ•’ <span id="liveClock">--:--:--</span></div>
    </div>

    <div class="container">
        <div class="sidebar">
            <select id="govSelect" onchange="handleSelect()">
                <option value="">-- Ø§Ø®ØªØ± Ù…Ø­Ø§ÙØ¸Ø© (27 Ù…Ø­Ø§ÙØ¸Ø©) --</option>
            </select>

            <div class="btn-group">
                <button class="gps-btn" onclick="getLocation()">ğŸ“ Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ</button>
                <button id="csvBtn" class="csv-btn" onclick="downloadCSV()">CSV ğŸ“¥</button>
            </div>
            
            <div class="weather-box" id="weatherDisplay">
                <div style="opacity: 0.5;">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†Ø·Ù‚Ø© Ù„Ù„ØªØ­Ù„ÙŠÙ„...</div>
            </div>
        </div>
        
        <div id="map"></div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const API_KEY = "ee1bb6ea81434e09a3233509251812";
        let lastData = null;
        let currentMarker, pulseMarker;

        const governorates = [
            { name: "Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©", lat: 30.0444, lon: 31.2357, coastal: false },
            { name: "Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©", lat: 31.2001, lon: 29.9187, coastal: true },
            { name: "Ø§Ù„Ø¬ÙŠØ²Ø©", lat: 30.0131, lon: 31.2089, coastal: false },
            { name: "Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©", lat: 31.0364, lon: 31.3532, coastal: true },
            { name: "Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø­Ù…Ø±", lat: 27.2579, lon: 33.8116, coastal: true },
            { name: "Ø§Ù„Ø¨Ø­ÙŠØ±Ø©", lat: 31.0333, lon: 30.4667, coastal: true },
            { name: "Ø§Ù„ÙÙŠÙˆÙ…", lat: 29.3084, lon: 30.8428, coastal: false },
            { name: "Ø§Ù„ØºØ±Ø¨ÙŠØ©", lat: 30.8333, lon: 31.0000, coastal: false },
            { name: "Ø§Ù„Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ©", lat: 30.6043, lon: 32.2723, coastal: true },
            { name: "Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©", lat: 30.5972, lon: 30.9876, coastal: false },
            { name: "Ø§Ù„Ù…Ù†ÙŠØ§", lat: 28.1091, lon: 30.7503, coastal: false },
            { name: "Ø§Ù„Ù‚Ù„ÙŠÙˆØ¨ÙŠØ©", lat: 30.4100, lon: 31.2100, coastal: false },
            { name: "Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯", lat: 25.4514, lon: 30.5461, coastal: false },
            { name: "Ø§Ù„Ø´Ø±Ù‚ÙŠØ©", lat: 30.7327, lon: 31.7195, coastal: false },
            { name: "Ø§Ù„Ø³ÙˆÙŠØ³", lat: 29.9667, lon: 32.5333, coastal: true },
            { name: "Ø£Ø³ÙˆØ§Ù†", lat: 24.0889, lon: 32.8998, coastal: false },
            { name: "Ø£Ø³ÙŠÙˆØ·", lat: 27.1783, lon: 31.1859, coastal: false },
            { name: "Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ", lat: 29.0661, lon: 31.0994, coastal: false },
            { name: "Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯", lat: 31.2565, lon: 32.2841, coastal: true },
            { name: "Ø¯Ù…ÙŠØ§Ø·", lat: 31.4175, lon: 31.8144, coastal: true },
            { name: "Ø¬Ù†ÙˆØ¨ Ø³ÙŠÙ†Ø§Ø¡", lat: 28.5000, lon: 34.0000, coastal: true },
            { name: "ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®", lat: 31.1107, lon: 30.9388, coastal: true },
            { name: "Ù…Ø·Ø±ÙˆØ­", lat: 31.3543, lon: 27.2373, coastal: true },
            { name: "Ù‚Ù†Ø§", lat: 26.1551, lon: 32.7160, coastal: false },
            { name: "Ø´Ù…Ø§Ù„ Ø³ÙŠÙ†Ø§Ø¡", lat: 30.5000, lon: 33.5000, coastal: true },
            { name: "Ø³ÙˆÙ‡Ø§Ø¬", lat: 26.5591, lon: 31.6957, coastal: false },
            { name: "Ø§Ù„Ø£Ù‚ØµØ±", lat: 25.6872, lon: 32.6396, coastal: false }
        ].sort((a,b) => a.name.localeCompare(b.name, 'ar'));

        const selectEl = document.getElementById('govSelect');
        governorates.forEach((g, i) => selectEl.add(new Option(g.name, i)));

        const map = L.map('map', { zoomControl: false }).setView([26.8, 30.8], 6);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

        setInterval(() => { 
            document.getElementById('liveClock').innerText = new Date().toLocaleTimeString('ar-EG'); 
        }, 1000);

        function handleSelect() {
            const g = governorates[selectEl.value];
            if (g) updateUI(g.lat, g.lon, g.name, g.coastal);
        }

        map.on('click', e => updateUI(e.latlng.lat, e.latlng.lng, "Ø±ØµØ¯ ÙŠØ¯ÙˆÙŠ", false));

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(p => updateUI(p.coords.latitude, p.coords.longitude, "Ù…ÙˆÙ‚Ø¹ÙŠ", false));
            }
        }

        async function fetchWeather(lat, lon, label, isCoastal) {
            const display = document.getElementById('weatherDisplay');
            try {
                const res = await fetch(`https://api.weatherapi.com/v1/current.json?key=${API_KEY}&q=${lat},${lon}&lang=ar`);
                const data = await res.json();
                lastData = { name: label, ...data };
                
                const temp = data.current.temp_c;
                let tempClass = temp > 30 ? 'hot-effect' : (temp < 18 ? 'cold-effect' : '');

                display.className = `weather-box ${tempClass}`;
                display.innerHTML = `
                    ${isCoastal ? '<div class="coastal-tag">ğŸŒŠ Ù…Ù†Ø·Ù‚Ø© Ø³Ø§Ø­Ù„ÙŠØ©</div>' : ''}
                    <h2 style="margin:0;">${label}</h2>
                    <div class="temp-main">${Math.round(temp)}Â°</div>
                    <p style="font-weight:bold; color:var(--primary); font-size:1.3rem;">${data.current.condition.text}</p>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top:15px; font-size:0.9rem;">
                        <div>ğŸ’§ Ø±Ø·ÙˆØ¨Ø©: ${data.current.humidity}%</div>
                        <div>ğŸ’¨ Ø±ÙŠØ§Ø­: ${data.current.wind_kph} Ùƒ/Ø³</div>
                    </div>
                `;
                document.getElementById('csvBtn').style.display = 'block';
            } catch (e) { display.innerHTML = "ÙØ´Ù„ Ø§Ù„Ø±ØµØ¯"; }
        }

        function updateUI(lat, lon, label, isCoastal) {
            if (currentMarker) map.removeLayer(currentMarker);
            if (pulseMarker) map.removeLayer(pulseMarker);
            currentMarker = L.circleMarker([lat, lon], { radius: 10, color: '#fff', fillColor: '#00d2ff', fillOpacity: 1 }).addTo(map);
            pulseMarker = L.marker([lat, lon], { icon: L.divIcon({ className: 'radar-pulse', iconSize: [20, 20] }) }).addTo(map);
            map.flyTo([lat, lon], 9);
            fetchWeather(lat, lon, label, isCoastal);
        }

        function downloadCSV() {
            if (!lastData) return;
            const content = `\uFEFFØ§Ù„Ù…Ø­Ø§ÙØ¸Ø©,Ø§Ù„Ø­Ø±Ø§Ø±Ø©,Ø§Ù„Ø­Ø§Ù„Ø©,Ø§Ù„Ø±Ø·ÙˆØ¨Ø©,Ø§Ù„Ø±ÙŠØ§Ø­\n${lastData.name},${lastData.current.temp_c},${lastData.current.condition.text},${lastData.current.humidity}%,${lastData.current.wind_kph}km/h`;
            const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
            const a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = `Ø·Ù‚Ø³_Ù…ØµØ±_${lastData.name}.csv`;
            a.click();
        }
    </script>
</body>
</html>